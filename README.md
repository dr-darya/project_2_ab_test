# Проект A/B–тестирование + SQL
> Стек - pandas, plotly, requests, scipy, seaborn, pandahouse

#### Описание 
Это пример тестового задания. Тестовое включало три задания:
1. Проанализировать итоги эксперимента и сделать вывод, стоит ли запускать новую механику оплаты на всех пользователей.
2. Работа с SQL, написание оптимальных запросов
3. Реализация функций на Python, которые будут автоматически подгружать информацию + ф-я для построения графиков

Ниже я кратко опишу этапы реализации каждого задания и результат.
____
# 1.A/B–тестирование

### Задача
В ходе тестирования одной гипотезы целевой группе была предложена новая механика оплаты услуг на сайте, у контрольной группы оставалась базовая механика. 
Необходимо проанализировать итоги аб теста  и сделать вывод, стоит ли запускать новую механику оплаты на всех пользователей.

### Этапы реализации
1. Провести предварительный анализ, подготовить дф для дальнейшей работы. 
2. Определить метрики, которые я буду анализировать.
3. Найти различия в показателях, если они есть. Объяснить с чем они могут быть связаны.
4. Определить являются ли эти различия статистически значимыми.
6. Решение: запускать новую механику на всех пользователей?

### Реализация
1. Загрузила данные по апи.
2. При предподготовке данных **обнаружила пользователей(149), которые совершили оплату, но без посещения образовательной платформы** во время проведения эксперимента. Приняла решения их не брать в анализ и в расчет метрик, потому что аб тест расчитан на активных пользователей, те кто идет с образовательной платформы.
3. Выделила для расчета три метрики: Conversion Rate,ARPU,ARPPU.
4. Выявила разницу между пользователями в группах:
     - **В экспериментальной группе cамый популярный чек на 1900, а в контрольной группе лидирует по частоте встречаемости чек на 290**. Это может говорить о том, что в группе б у нас пользователи были активнее и, возможно, было акционное предложение на этот чек в момент проведения эксперимента, поэтому так много покупок на эту сумму. 
**Также среднее значение и медианное значение чека в группе б выше, чем в группе а**. Это также подтверждает, что в группе б пользователи были активнее. 
5. По каждой метрике провела проверку на наличие стат.значимых различий, использовала следующие стат.тесты:
     - **Conversion Rate - я использовала ХИ-КВАДРАТ**, поскольку эту метрику можно отнести к пропорции. 
     - **ARPU - я приняла решение использовать т-тест**. Распределние было не похоже на нормальное, оно скошено влево. Обычно при таких вводных используют непараметрику, но насколько мне известно из лекций, что т-тест можно использовать.
     - **ARPPU - значения в выборке в обоих группах распределены ненормально. Я использовала бутсрап для сравнения ARPPU**.
6. Я выделила 3 метрики для нахождения стат значимых различий между группами. Две метрики, а именно: конверсия в покупку и ARPU не дали стат значимых различий, это была случайная флуктуация. Статистический анализ метрик показал, что в группе пользователей с новой механикой оплаты - статистически увеличился средний чек платящего пользователя, они активнее покупали, самый популярный чек был на 1900т. Повторюсь, видимо была запущена акция/выгодное предложение/рекл компания. Также я анализировала конверсию в покупку и ARPU в группах, анализ не дал статистически значимых различий. Механика оплаты повлияла только на доход от платящих пользователей, но не повлияла на конверсию. Скорее всего на увеличение среднего чека плат пользователей повлиял не запуск новой механики оплаты, а что-то другое.

**Рекомендация** 

Я думаю пока не нужно катить новую механику оплаты на всех пользователей. Нужно разобраться, что могло повлиять на увеличение ARPPU. А также разобраться как были сформированы группы для теста. Учесть все ошибки и провести другой аб тест.

#### Данные
4 csv-файла:
- groups.csv - файл с информацией о принадлежности пользователя к контрольной или экспериментальной группе (А – контроль, B – целевая группа) 
- groups_add.csv - дополнительный файл с пользователями, который вам прислали спустя 2 дня после передачи данных
- active_studs.csv - файл с информацией о пользователях, которые зашли на платформу в дни проведения эксперимента. 
- checks.csv - файл с информацией об оплатах пользователей в дни проведения эксперимента.
  
# 2.SQL.ClickHouse

### Описание задания
Все данные находятся в табличном ввиде в **ClickHouse**. Нужно написать оптимальные запросы по каждой задаче: 
1. Необходимо написать оптимальный запрос, который даст информацию о количестве очень усердных студентов. Усердный студент -  студент, решивший правильно 20 задач за текущий месяц.
2. Образовательная платформа предлагает пройти студентам курсы по модели trial: студент может решить бесплатно лишь 30 горошин в день. Для неограниченного количества заданий в определенной дисциплине студенту необходимо приобрести полный доступ. Команда провела эксперимент, где был протестирован новый экран оплаты. Необходимо в одном запросе выгрузить следующую информацию о группах пользователей:
   - ARPU
   - ARPAU
   - CR в покупку
   - СR активного пользователя в покупку
   - CR пользователя из активности по математике (subject = ’math’) в покупку курса по математике
   - ARPU считается относительно всех пользователей, попавших в группы.
     
**Активным** считается пользователь, за все время решивший больше 10 задач правильно в любых дисциплинах.

**Активным по математике** считается пользователь, за все время решивший 2 или больше задач правильно по математике.

### Реализация
1. Подключилась к ClickHouse
2. Написала запрос о кол-ве усердных студентов. Выяснила, что на образовательной платформе 136 усердных студентов.
3. Выгрузила необходимые метрики.
   - ARPU в группе Pilot **увеличился на 2.53**
   - ARPAU в группе Pilot **увеличился на 2.86**
   - CR в покупку в группе Pilot **увеличился на 2.21**
   - CR активного пользователя в покупку в группе Pilot **увеличился на 2.36**
   - CR пользователя из активности по математике в покупку курса по математике **увеличился на 1.56**

Мы получили следующие метрики в группах. Показатели в тестовой группе выше чем в контрольной группе, нужно проверять есть ли стат.значимые различия в группах и делать вывод стоит ли запускать новый экран оплаты на всех юзеров. 

#### Данные

**default.peas:**

|Название атрибута|Тип атрибута|Смысловое значение|
|-----------------|------------|------------------|
|st_id|	int|	ID ученика|
|timest|	timestamp|	Время решения карточки|
|correct|	bool|	Правильно ли решена горошина?|
|subject|	text|	Дисциплина, в которой находится горошина|

**default.peas (см. выше), default.studs:**

|Название атрибута|Тип атрибута|Смысловое значение|
|-----------------|------------|------------------|
|st_id|	int|ID ученика|
|test_grp|text|Метка ученика в данном эксперименте|

**default.final_project_check:**

|Название атрибута|Тип атрибута|Смысловое значение|
|-----------------|------------|------------------|
|st_id|int|ID ученика|
|sale_time|timestamp|Время покупки|
|money|int|Цена, по которой приобрели данный курс|
|subject|text|


# 3. Python

### Описание задания
Нужно реализовать функцию, которая будет автоматически подгружать информацию из дополнительного файла **groups_add.csv** (заголовки могут отличаться) и на основании дополнительных параметров пересчитывать метрики. Реализовать функцию, которая будет строить графики по получаемым метрикам.

### Реализация
Написала функцию - **def calculate_metrics(link_groups_add)**, которая будет автоматически подгружать информацию из дополнительного файла groups_add.csv и на основании дополнительных параметров пересчитывать метрики. Здесь я позаимствовала код из первого задания. 
Вторая функция - **def plot_metrics(data)**, которая строит графики по получаемым метрикам. 

    

